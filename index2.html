<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multiple Scratch Cards</title>
    <script src="https://cdn.jsdelivr.net/npm/scratchcard-js@1.5.5/build/scratchcard.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: row;
      gap: 20px;
    }
    .test {
      width: 245px;
      height: 200px;
      background: red;
      position: relative;
      z-index: 3;
    }
    .test img {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: contain;
      z-index: -1;
    }
  </style>
  <body>
    <div id="appendDivs"></div>
    <!-- <div id="jsContainer1" class="_scratchCard"></div>
    <div id="jsContainer2" class="_scratchCard"></div>
    <div id="jsContainer3" class="_scratchCard"></div> -->

    <script>
      let containerAppended = false;
      let prize = "safasf";
      function addNewDivContainer() {
        if (!containerAppended) {
          // cardsShow.play();
          let htmlStructure = `
      <div class="_scrathContainer _apDiv _hR">

        <div class="_scratchCardParent">
          ${Array.from(
            { length: 3 },
            (_, i) => `
            <div class="frame_scratch">
           <div class="prizeScratch"></div>
              <div class="${"_scratch" + "" + (i + 1)} _scratchCard" id=${
              "jsContainer" + "" + (i + 1)
            }>
             </div>
            </div>
          `
          ).join("")}
        </div>
      </div>
    `;
          $("#appendDivs").append(htmlStructure);

          containerAppended = true;

          addScrath();
        } else {
          console.log("Container already appended");
        }
      }
      addNewDivContainer();
      function addScrath() {
        console.log("loaded Scratch Script");

        const completionStatus = {
          jsContainer1: false,
          jsContainer2: false,
          jsContainer3: false,
        };
        //      enabledPercentUpdate: true,
        //    brushSrc: "./png/brush.png",
        function createScratchCard(
          containerId,
          imageForwardSrc,
          imageBackgroundSrc
        ) {
          const _containerBox = document.getElementById(containerId);
          console.log(_containerBox, "each containerId");
          const sc = new ScratchCard(_containerBox, {
            scratchType: SCRATCH_TYPE.BRUSH,
            containerWidth: _containerBox.offsetWidth,
            containerHeight: _containerBox.offsetHeight,
            imageForwardSrc: imageForwardSrc,
            imageBackgroundSrc: imageBackgroundSrc,
            htmlBackground: "", // for percent
            percentToFinish: 45,
            clearZoneRadius: 0, //for line
            nPoints: 0, //for spray
            pointSize: 0,
            brushSrc: "./png/brush.webp",
            callback: function () {
              let percent = sc.getPercent();
              // console.log(percent, "callback get done");
              if (containerId) {
                // console.log(containerId, "each containerId");
                const completedContainers = Object.values(
                  completionStatus
                ).filter((status) => !status);
                //from 3xfalse > 1xfalse==true
                console.log(completedContainers, "fasfasf");
                if (completedContainers.length === 1 && percent >= 90) {
                  $("._scratchCard").css("pointerEvents", "none");
                  setTimeout(function () {
                    alert("itsDone");
                    // startConfetti();
                    // jackpotWin.play();
                    // showModal(
                    //   "Congratulations",
                    //   `"You won" ${prizePool}`,
                    //   "scenario2"
                    // );
                  }, 1000);
                }
              }
            },
          });

          sc.init()
            .then(() => {
              sc.canvas.addEventListener("scratch.move", () => {
                let percent = sc.getPercent();
                console.log(percent.toFixed(0));

                // console.log(percent, "scratch move");
                if (!completionStatus[containerId]) {
                  if (percent >= 0) {
                    completionStatus[containerId] = true;
                    //find status true
                    const completedContainers = Object.values(
                      completionStatus
                    ).filter((status) => status);
                    console.log(completedContainers, "fasfasf");
                    // console.log(completedContainers);
                    //complete status 2xtrue
                    if (completedContainers.length === 2) {
                      const remainingContainerId = Object.keys(
                        completionStatus
                      ).find((id) => !completionStatus[id]);

                      if (remainingContainerId) {
                        document.getElementById(
                          remainingContainerId
                        ).style.pointerEvents = "none";
                        // document.getElementById(remainingContainerId).style.display =
                        //   "none";
                      }
                      console.log(
                        "Two containers reached 50% or more! No more scratching allowed.percent >= 0.1",
                        percent
                      );
                      return;
                    }
                  }
                }
                if (percent >= 20) {
                  console.log(_containerBox, "Fas");
                  if (_containerBox) {
                    $(".prizeScratch").text(prize);
                  }
                }
              });
            })
            .catch((error) => {
              console.error("Error initializing scratch card:", error);
            });
        }

        const containerIds = ["jsContainer1", "jsContainer2", "jsContainer3"];

        containerIds.forEach((id) => {
          createScratchCard(
            id,
            "./png/elements/unscratched.webp",
            "./png/elements/scratched.webp"
          );
        });
        console.log("test");
        // function reloadPage() {
        //   location.reload();
        // }
        // window.addEventListener("resize", reloadPage);
      }
      // addScrath();
    </script>
  </body>
</html>
